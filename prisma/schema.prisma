// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean   @default(false)
  alamat        String?
  notelp        String?
  tipe          String       @default("user")  // owner, admin, user
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  sessions      Session[]
  accounts      Account[]
  jurnal        Jurnal[]
  pembelian     Pembelian[]
  penjualan     Penjualan[]
  gaji          Gaji[]

  @@unique([email])
  @@index([name])
  @@map("user")
}

model Kategori {
  id           Int    @id   @default(autoincrement())
  nama         String

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  produk      Produk[]

  @@index([nama])
  @@map("kategori")
}

model Produk {
  id            Int     @id  @default(autoincrement())
  nama          String
  barcode       String?  @unique
  harga_jual    Int
  harga_beli    Int
  stok          Int
  jenis         String   @default("BARANG")
  keterangan    String?
  kategoriId    Int

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  kategori      Kategori  @relation(fields: [kategoriId], references: [id], onDelete: Cascade)
  pembeliandetal  PembelianDetail[]
  penjualandetail PenjualanDetail[]


  @@index([nama])
  @@index([barcode])
  @@map("produk")

}

model Distributor{
  id          Int     @id   @default(autoincrement())
  nama        String
  alamat      String?
  notelp      String?
  email       String?
  keterangan  String?

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  pembelian   Pembelian[]

  @@index([nama])
  @@map("distributor")
}

enum StatusPembelian {
  DIPESAN
  SELESAI
  BATAL

}

model Pembelian{
  id          Int     @id   @default(autoincrement())
  kode        String  @unique
  status      StatusPembelian
  metode      MetodeBayar
  jumlahtotal Int
  biayakirim  Int
  distributorId Int?
  userId      String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  distributor Distributor?  @relation(fields: [distributorId], references: [id], onDelete: Cascade)
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  pembeliandetail PembelianDetail[]

  @@index([kode])
  @@map("pembelian")

}

model PembelianDetail {
  id          Int   @id   @default(autoincrement())
  pembelianId Int
  produkId    Int
  jumlah      Int
  harga       Int
  total       Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  pembelian   Pembelian @relation(fields: [pembelianId], references: [id], onDelete: Cascade)
  produk      Produk    @relation(fields: [produkId], references: [id], onDelete: Cascade)
}

enum StatusPenjualan {
  SELESAI
  BATAL
}

enum MetodeBayar {
  CASH
  QRIS
  TRANSFER
  E_WALLET
}

model Penjualan {
  id            Int   @id @default(autoincrement())
  kode          String  @unique
  status        StatusPenjualan
  metode        MetodeBayar
  jumlahtotal   Int
  userId        String

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([kode])
  @@map("penjualan")

}

model PenjualanDetail {
  id            Int     @id @default(autoincrement())
  penjualanId   Int
  produkId      Int
  harga         Int
  jumlah        Int
  total         Int

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  produk        Produk  @relation(fields: [produkId], references: [id], onDelete: Cascade)
}

enum AkunJurnal {
  PENJUALAN
  PEMBELIAN
  HPP
  KAS
  BANK
  PIUTANG
}

model Jurnal  {
  id          Int     @id   @default(autoincrement())
  kode        String
  akun        AkunJurnal
  debit       Decimal  
  kredit      Decimal
  keterangan   String?
  sumber      String?
  userId      String

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([kode])
  @@index([userId])
  @@map("jurnal")
}

model Pengaturan {
  id          Int       @id
  tarif_ppn   Decimal


}

model Toko {
  nama        String    @id
  alamat      String
  notelp      String?
  email       String
  siup        String?
  npwp        String?

  updatedAt   DateTime    @updatedAt
}

model Gaji {
  id        Int   @id  @default(autoincrement())
  kode_gaji String  @unique
  userId    String
  nama_user String
  gaji_nett Int       
  tanggal   DateTime  @default(now())
  update    DateTime  @updatedAt

  user      User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  gajidetail GajiDetail[]

  @@index([nama_user])
  @@index([kode_gaji])
  @@map("gaji")

}

model GajiDetail {
  id        Int   @id  @default(autoincrement())
  gajiId    Int
  gaji_pokok  Int     @default(0)
  tidak_masuk Int?    @default(0)
  bonus       Int?    @default(0)
  kategori_ptkp String    @default("tk0")
  isbpjs        Boolean
  bpjs_nilai  Int   @default(0)
  ispph         Boolean
  pph_nilai     Int   @default(0)

  gaji       Gaji    @relation(fields: [gajiId], references: [id])

  @@index([gajiId])
  @@map("gajidetail")

}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Jwks {
  id        String    @id
  publicKey String
  privateKey String
  createdAt  DateTime
  expiresAt  DateTime?
}